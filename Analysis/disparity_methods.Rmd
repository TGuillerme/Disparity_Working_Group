---
title: "Disparate views of disparity"
author: "Thomas Guillerme"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_width: 12
    fig_height: 6
---

```{r}
source("../Functions/fuzzy.sort.data.R")
```

# Data

## Data collection from google scholars

I collected the data from Google scholar per year for the key words "morphological disparity".
I analysed all 100 <!--@@@ TG: check if I stick to this value or not --> papers for each year and collected the following data:
 
 * The paper details
 * Whether or not the paper contained a disparity analysis (for consistency)
 * The focal biological group
 * The type of data (3D landmarks, discrete data, etc...)
 * Whether the full organism was used or not.
 * How was the morphospace implicitly defined?
 * How was disparity implicitly defined?
 * Which test was applied for testing hypothesis?
 * Was phylogeny taken into account?

Additionally I collected the number of matches per year for the terms "morphological disparity" both in the text (fuzzy matching) or in the title (exact matching).

## Data wrangling

I then categorised the data as follows.
<!-- @@@ -->

```{r}
## Reading the data
data_raw <- read.csv("../Data/disparity_methods.csv", stringsAsFactors = FALSE)
search_results <- read.csv("../Data/GoogleSearch_occurences.csv", stringsAsFactors = FALSE)

## Keeping only the studies with data
data <- data_raw[apply(data_raw[, 3:9], 1, function(X) ifelse(all(X == "-"), FALSE, TRUE)), ]
```

## Sorting the data to categorise it

The categories for each variable are:

```{r}
## Categories definition
data_type <- c("3D landmarks", "2D landmarks", "continuous", "discrete", "body", "metabolic")
full_organism <- c("yes", "no")
morphospace <- c("PCA", "MDS", "PCO", "PCOA", "Raup")
disparity <- c("sum of variance", "sum of range", "product of variance", "product of range", "distance", "observed") #TG: Area from observed to estimated (DTT)
test <- c("anova", "model fitting", "canonical")
phylo <- c("yes", "no", "mapped")

factors <- list("data type" = data_type, "full organism" = full_organism, "morphospace" = morphospace, "disparity" = disparity, "test" = test, "phylo correction" = phylo)
```


```{r, fig.width = 12, fig.height = 12}
## Plotting the results
par(mfrow = c(2, 3))
for(factor in 1:length(factors)) {
    plot.data(fuzzy.sort.data(data[,3+factor], factors[[factor]]), proportion = TRUE, ylim = c(0, 100), main = names(factors)[[factor]])    
}
```


```{r}
## Printing the tables
factor <- 1
table.data(fuzzy.sort.data(data[,3+factor], factors[[factor]]), table = "tex")

```


<!-- 
How many studies use such and such definition: disparate views on disparity -> but maybe disparity is a vague concept?
How many studies use different definition for such or such parameter recorded: on average, disparity is defined as a single thing...

Parallel with diversity: it was a blurry thing - check out different diversity literature.
 -->


# Occurence of morphological disparity papers

```{r}
disparity_fuzzy <- search_results[-c(1:2, 60:65),3]
disparity_exact <- search_results[-c(1:2, 60:65),2]

## Number of papers
plot(seq(from = 1960, to = 2016), rev(disparity_fuzzy)/max(disparity_fuzzy), type = "l", xlab = "", ylab = "Proportion of papers")
lines(seq(from = 1960, to = 2016), rev(disparity_exact)/max(disparity_exact), type = "l", col = "grey")
```


# Supplementary

## Number of papers collected for each parameter


```{r, fig.width = 12, fig.height = 12}
## Get the data for cumulative curves
total_cumulative <- data_raw[,c(1,3)]
#data_type_cumulative <- data_raw[,c(1,4)]

## Transform the cumulative data into binary
results <- grep("-", total_cumulative[,2])
results <- cbind(results, seq(1:length(results)))

plot(add, type = "line", xlab = "Number of Google Scholar matches", ylab = "Number of new entries")

```


<!-- 
```{r, eval = FALSE, message = FALSE, fig.width = 12, fig.height = 12, echo = FALSE}
```
 -->