---
title: "Disparate views of disparity"
author: "Thomas Guillerme"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_width: 12
    fig_height: 6
---

```{r}
source("../Functions/fuzzy.sort.data.R")
```

# Data

## Data collection from google scholars

I collected the data from the 500 first Google Scholar results for the key words "morphological disparity" per order of appearance (accessed 1st of Noveember 2017).
This resulted in 232 relevant papers for which I collected:
 
 * The focal biological group
 * The type of data (3D landmarks, discrete data, etc...)
 * Whether the full organism was used or not.
 * How was the morphospace explicitly defined?
 * How was disparity explicitly defined?
 * Which test was applied for testing hypothesis?
 * Was phylogeny taken into account?

In the other 268 papers disparity was mentioned but not measured.
This happened for papers falling in the following categories:
 
 * Out of topic
 * Morphological descriptions
 * Review paper
 * Paper not accessible (broken link or paywall)
 * Citation only

Additionally I collected the number of matches per year from 1960 to 2016 for the terms "morphological disparity" both in the text (fuzzy matching) or in the title (exact matching).

## Data wrangling

I then categorised the data as follows.
<!-- @@@ -->

```{r}
## Reading the data
data_raw <- read.csv("../Data/disparity_methods.csv", stringsAsFactors = FALSE)
search_results <- read.csv("../Data/GoogleSearch_occurences.csv", stringsAsFactors = FALSE)

## Keeping only the studies with data
data <- data_raw[apply(data_raw[, 3:9], 1, function(X) ifelse(all(X == "-"), FALSE, TRUE)), ]
```

# Occurrences of morphological disparity papers

This first analysis just shows that disparity analysis in morphology are steadily and rapidly increasing since the 2000s:

```{r, fig.width = 8, fig.height = 8}
disparity_fuzzy <- search_results[-c(1:2, 60:65),3]
disparity_exact <- search_results[-c(1:2, 60:65),2]

## Number of papers
# pdf("../Paper/Figures/GoogleScholarOccurences.pdf", width = 8, height = 8)
op <- par(bty = "n")
plot(seq(from = 1960, to = 2016), rev(disparity_fuzzy)/search_results[1,3], type = "l", xlab = "", ylab = "Relative number of papers per year", ylim = c(0, 0.1))
lines(seq(from = 1960, to = 2016), rev(disparity_exact)/search_results[1,2], type = "l", col = "grey")
par(op)
# dev.off()
```

Not much to say here but that it is a trendy topic!

# Disparate views of disparity

Disparity methods comes in all flavours!

## Sorting the variables

The variables can be sorted as follow:

```{r}

## Categories definition
data_type <- c("3D landmarks", "2D landmarks", "continuous", "discrete", "body", "metabolic")
full_organism <- c("yes", "no")
morphospace <- c("PCA", "MDS", "PCO", "PCOA", "Raup")
disparity <- c("sum of variance", "sum of range", "product of variance", "product of range", "distance", "observed") #TG: Area from observed to estimated (DTT)
test <- c("anova", "model fitting", "canonical", "confidence interval")
phylo <- c("yes", "no", "mapped")

factors <- list("data type" = data_type, "full organism" = full_organism, "morphospace" = morphospace, "disparity" = disparity, "test" = test, "phylo correction" = phylo)
```


```{r, fig.width = 12, fig.height = 12}
## Plotting the results
par(mfrow = c(2, 3))
for(factor in 1:length(factors)) {
    plot.data(fuzzy.sort.data(data[,3+factor], factors[[factor]]), proportion = TRUE, ylim = c(0, 100), main = names(factors)[[factor]])    
}
```


```{r}
## Printing the tables
factor <- 1
table.data(fuzzy.sort.data(data[,3+factor], factors[[factor]]), table = "tex")

```


<!-- 
How many studies use such and such definition: disparate views on disparity -> but maybe disparity is a vague concept?
How many studies use different definition for such or such parameter recorded: on average, disparity is defined as a single thing...

Parallel with diversity: it was a blurry thing - check out different diversity literature.
 -->


# Occurrences of morphological disparity papers

```{r}
disparity_fuzzy <- search_results[-c(1:2, 60:65),3]
disparity_exact <- search_results[-c(1:2, 60:65),2]

## Number of papers
pdf("../Writing/Figures/GoogleScholarOccurences.pdf", width = 8, height = 8)
op <- par(bty = "n")
plot(seq(from = 1960, to = 2016), rev(disparity_fuzzy)/search_results[1,3], type = "l", xlab = "", ylab = "Number of papers per year", ylim = c(0, 0.1), yaxt = "n")
lines(seq(from = 1960, to = 2016), rev(disparity_exact)/search_results[1,2], type = "l", col = "grey")
## Adding the axis
axis(2, at = seq(from = 0, to = 0.08, by = 0.02), labels = round(seq(from = min(disparity_fuzzy), to = max(disparity_fuzzy), length.out = 5)) )
axis(4, at = seq(from = 0, to = 0.1, by = 0.02), labels = round(seq(from = min(disparity_exact), to = max(disparity_exact), length.out = 6)), col = "grey", las = 2)

par(op)
dev.off()
```


# Supplementary

## Number of papers collected for each parameter


```{r, fig.width = 12, fig.height = 12}
## Get the data for cumulative curves
total_cumulative <- data_raw[,c(1,3)]
#data_type_cumulative <- data_raw[,c(1,4)]

## Transform the cumulative data into binary
results <- grep("-", total_cumulative[,2])
results <- cbind(results, seq(1:length(results)))

plot(add, type = "line", xlab = "Number of Google Scholar matches", ylab = "Number of new entries")

```


<!-- 
```{r, eval = FALSE, message = FALSE, fig.width = 12, fig.height = 12, echo = FALSE}
```
 -->